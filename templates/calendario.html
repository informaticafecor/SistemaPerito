<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SistemaPerito - Calendario</title>
    
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Estilos para el calendario */
        .calendario-dia {
            min-height: 100px;
            transition: all 0.3s ease;
        }
        
        .calendario-dia:hover {
            background-color: #f3f4f6;
            transform: scale(1.02);
        }
        
        .evento-perito {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-bottom: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .evento-perito:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* Colores por tipo de perito */
        .tipo-informatico { background-color: #DBEAFE; color: #1E40AF; border-left: 3px solid #3B82F6; }
        .tipo-acustico { background-color: #E9D5FF; color: #6B21A8; border-left: 3px solid #9333EA; }
        .tipo-antropologo { background-color: #D1FAE5; color: #065F46; border-left: 3px solid #10B981; }
        .tipo-contable { background-color: #FEF3C7; color: #92400E; border-left: 3px solid #F59E0B; }
        
        /* Día actual */
        .dia-actual {
            background-color: #EFF6FF;
            border: 2px solid #3B82F6;
        }
        
        /* Día con asignaciones */
        .dia-con-asignaciones {
            font-weight: bold;
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- Navegación Principal -->
    <nav class="bg-blue-900 text-white shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-balance-scale text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">SistemaPerito</h1>
                        <p class="text-sm text-blue-200">Gestión de Asignaciones</p>
                    </div>
                </div>
                
                <!-- Menú de navegación -->
                <div class="flex space-x-1">
                    <a href="/" class="px-4 py-2 rounded-lg hover:bg-blue-800 transition">
                        <i class="fas fa-home mr-2"></i>Dashboard
                    </a>
                    <a href="/nuevo" class="px-4 py-2 rounded-lg hover:bg-blue-800 transition">
                        <i class="fas fa-plus mr-2"></i>Nueva Asignación
                    </a>
                    <a href="/buscar" class="px-4 py-2 rounded-lg hover:bg-blue-800 transition">
                        <i class="fas fa-search mr-2"></i>Buscar
                    </a>
                    <a href="/calendario" class="px-4 py-2 bg-blue-800 rounded-lg hover:bg-blue-700 transition">
                        <i class="fas fa-calendar mr-2"></i>Calendario
                    </a>
                    <a href="/peritos" class="px-4 py-2 rounded-lg hover:bg-blue-800 transition">
                        <i class="fas fa-users mr-2"></i>Peritos
                    </a>
                    <a href="/reportes" class="px-4 py-2 rounded-lg hover:bg-blue-800 transition">
                        <i class="fas fa-chart-bar mr-2"></i>Reportes
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="container mx-auto px-4 py-8">
        
        <!-- Título de la página -->
        <div class="mb-8 fade-in">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-calendar-alt text-blue-600 mr-3"></i>Calendario de Asignaciones
            </h2>
            <p class="text-gray-600">Vista mensual de asignaciones de peritos</p>
        </div>

        <!-- Controles del Calendario -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 fade-in">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Navegación Mes/Año -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-calendar-day text-blue-600 mr-2"></i>Seleccionar Mes y Año
                    </label>
                    <div class="flex space-x-3">
                        <button onclick="mesAnterior()" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        
                        <select id="mesSelect" 
                                onchange="cargarCalendario()"
                                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                            <option value="0">Enero</option>
                            <option value="1">Febrero</option>
                            <option value="2">Marzo</option>
                            <option value="3">Abril</option>
                            <option value="4">Mayo</option>
                            <option value="5">Junio</option>
                            <option value="6">Julio</option>
                            <option value="7">Agosto</option>
                            <option value="8">Septiembre</option>
                            <option value="9">Octubre</option>
                            <option value="10">Noviembre</option>
                            <option value="11">Diciembre</option>
                        </select>
                        
                        <select id="anioSelect" 
                                onchange="cargarCalendario()"
                                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                            <!-- Se llenará dinámicamente -->
                        </select>
                        
                        <button onclick="mesSiguiente()" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        
                        <button onclick="irHoy()" 
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            <i class="fas fa-calendar-check mr-2"></i>Hoy
                        </button>
                    </div>
                </div>

                <!-- Filtro por Perito -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-user-tie text-green-600 mr-2"></i>Filtrar por Perito
                    </label>
                    <select id="filtroPerito" 
                            onchange="cargarCalendario()"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                        <option value="">Todos los peritos</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Leyenda de Colores -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 fade-in">
            <h3 class="text-lg font-bold text-gray-800 mb-4">
                <i class="fas fa-palette mr-2"></i>Leyenda de Tipos de Perito
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="flex items-center space-x-2">
                    <div class="w-6 h-6 bg-blue-200 border-l-4 border-blue-600 rounded"></div>
                    <span class="text-sm font-semibold text-gray-700">Informático</span>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="w-6 h-6 bg-purple-200 border-l-4 border-purple-600 rounded"></div>
                    <span class="text-sm font-semibold text-gray-700">Acústico</span>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="w-6 h-6 bg-green-200 border-l-4 border-green-600 rounded"></div>
                    <span class="text-sm font-semibold text-gray-700">Antropólogo</span>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="w-6 h-6 bg-yellow-200 border-l-4 border-yellow-600 rounded"></div>
                    <span class="text-sm font-semibold text-gray-700">Contable</span>
                </div>
            </div>
        </div>

        <!-- Estadísticas del Mes -->
        <div id="estadisticasMes" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <!-- Se llenarán dinámicamente -->
        </div>

        <!-- Calendario -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden fade-in">
            <div class="bg-gradient-to-r from-blue-900 to-blue-800 px-6 py-4">
                <h3 class="text-2xl font-bold text-white text-center" id="tituloMes">
                    <!-- Se llenará dinámicamente -->
                </h3>
            </div>

            <!-- Encabezado de días -->
            <div class="grid grid-cols-7 bg-gray-100 border-b">
                <div class="py-3 text-center font-bold text-gray-700 border-r">
                    <i class="fas fa-sun text-yellow-500 mr-1"></i>Domingo
                </div>
                <div class="py-3 text-center font-bold text-gray-700 border-r">Lunes</div>
                <div class="py-3 text-center font-bold text-gray-700 border-r">Martes</div>
                <div class="py-3 text-center font-bold text-gray-700 border-r">Miércoles</div>
                <div class="py-3 text-center font-bold text-gray-700 border-r">Jueves</div>
                <div class="py-3 text-center font-bold text-gray-700 border-r">Viernes</div>
                <div class="py-3 text-center font-bold text-gray-700">
                    <i class="fas fa-moon text-blue-500 mr-1"></i>Sábado
                </div>
            </div>

            <!-- Cuerpo del calendario -->
            <div id="calendarioBody" class="grid grid-cols-7">
                <!-- Se llenará dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Modal para Ver Detalle de Día -->
    <div id="modalDia" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-blue-900 to-blue-800 px-6 py-4 flex justify-between items-center">
                <h3 class="text-xl font-bold text-white" id="tituloDia">
                    <i class="fas fa-calendar-day mr-2"></i>Asignaciones del Día
                </h3>
                <button onclick="cerrarModalDia()" class="text-white hover:text-gray-200">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="contenidoDia" class="p-6">
                <!-- El contenido se cargará dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Modal para Ver Detalle de Asignación -->
    <div id="modalDetalle" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-blue-900 to-blue-800 px-6 py-4 flex justify-between items-center">
                <h3 class="text-xl font-bold text-white">
                    <i class="fas fa-info-circle mr-2"></i>Detalle de Asignación
                </h3>
                <button onclick="cerrarModalDetalle()" class="text-white hover:text-gray-200">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="contenidoDetalle" class="p-6">
                <!-- El contenido se cargará dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12 py-6">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm">
                <i class="fas fa-balance-scale mr-2"></i>SistemaPerito © 2025 - Sistema de Gestión de Asignaciones
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // Variables globales
        let mesActual = new Date().getMonth();
        let anioActual = new Date().getFullYear();
        let asignacionesDelMes = [];

        /**
         * Inicializar al cargar la página
         */
        document.addEventListener('DOMContentLoaded', function() {
            inicializarSelectores();
            cargarPeritos();
            cargarCalendario();
        });

        /**
         * Inicializar selectores de mes y año
         */
        function inicializarSelectores() {
            // Establecer mes y año actual
            document.getElementById('mesSelect').value = mesActual;
            
            // Llenar selector de años (2020-2030)
            const anioSelect = document.getElementById('anioSelect');
            for (let anio = 2020; anio <= 2030; anio++) {
                const option = document.createElement('option');
                option.value = anio;
                option.textContent = anio;
                if (anio === anioActual) option.selected = true;
                anioSelect.appendChild(option);
            }
        }

        /**
         * Cargar lista de peritos
         */
        function cargarPeritos() {
            fetch('/api/peritos')
                .then(response => response.json())
                .then(peritos => {
                    const selectPerito = document.getElementById('filtroPerito');
                    peritos.forEach(perito => {
                        const option = document.createElement('option');
                        option.value = perito.id;
                        option.textContent = `${perito.nombre} (${perito.tipo})`;
                        selectPerito.appendChild(option);
                    });
                })
                .catch(error => console.error('Error al cargar peritos:', error));
        }

        /**
         * Cargar calendario del mes seleccionado
         */
        function cargarCalendario() {
            mesActual = parseInt(document.getElementById('mesSelect').value);
            anioActual = parseInt(document.getElementById('anioSelect').value);
            
            // Actualizar título
            const nombresMeses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                                  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            document.getElementById('tituloMes').textContent = `${nombresMeses[mesActual]} ${anioActual}`;
            
            // Obtener primer y último día del mes
            const primerDia = new Date(anioActual, mesActual, 1);
            const ultimoDia = new Date(anioActual, mesActual + 1, 0);
            
            // Calcular rango de fechas para la consulta
            const fechaDesde = `${anioActual}-${String(mesActual + 1).padStart(2, '0')}-01`;
            const fechaHasta = `${anioActual}-${String(mesActual + 1).padStart(2, '0')}-${ultimoDia.getDate()}`;
            
            // Construir parámetros de búsqueda
            const params = new URLSearchParams({
                fecha_desde: fechaDesde,
                fecha_hasta: fechaHasta
            });
            
            const peritoFiltro = document.getElementById('filtroPerito').value;
            if (peritoFiltro) {
                params.append('perito_id', peritoFiltro);
            }
            
            // Obtener asignaciones del mes
            fetch(`/api/asignaciones?${params.toString()}`)
                .then(response => response.json())
                .then(data => {
                    asignacionesDelMes = data;
                    renderizarCalendario(primerDia, ultimoDia);
                    actualizarEstadisticas();
                })
                .catch(error => {
                    console.error('Error al cargar asignaciones:', error);
                    renderizarCalendario(primerDia, ultimoDia);
                });
        }

        /**
         * Renderizar el calendario
         */
        function renderizarCalendario(primerDia, ultimoDia) {
            const calendarioBody = document.getElementById('calendarioBody');
            calendarioBody.innerHTML = '';
            
            // Obtener día de la semana del primer día (0 = domingo)
            const diaSemana = primerDia.getDay();
            
            // Crear celdas vacías para días antes del primer día
            for (let i = 0; i < diaSemana; i++) {
                const celda = document.createElement('div');
                celda.className = 'calendario-dia border-r border-b bg-gray-50';
                calendarioBody.appendChild(celda);
            }
            
            // Obtener fecha de hoy para comparar
            const hoy = new Date();
            const hoyStr = `${hoy.getFullYear()}-${String(hoy.getMonth() + 1).padStart(2, '0')}-${String(hoy.getDate()).padStart(2, '0')}`;
            
            // Crear celdas para cada día del mes
            for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
                const fechaActual = `${anioActual}-${String(mesActual + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
                
                // Filtrar asignaciones para este día
                const asignacionesDia = asignacionesDelMes.filter(a => {
                    return fechaActual >= a.fecha_inicio && fechaActual <= a.fecha_fin;
                });
                
                const celda = document.createElement('div');
                celda.className = 'calendario-dia border-r border-b p-2 relative';
                
                // Marcar día actual
                if (fechaActual === hoyStr) {
                    celda.classList.add('dia-actual');
                }
                
                // Marcar días con asignaciones
                if (asignacionesDia.length > 0) {
                    celda.classList.add('dia-con-asignaciones');
                }
                
                // Número del día
                const numeroDia = document.createElement('div');
                numeroDia.className = 'text-lg font-bold text-gray-700 mb-2';
                numeroDia.textContent = dia;
                celda.appendChild(numeroDia);
                
                // Mostrar asignaciones (máximo 3, si hay más mostrar indicador)
                const maxMostrar = 3;
                asignacionesDia.slice(0, maxMostrar).forEach(asignacion => {
                    const evento = document.createElement('div');
                    evento.className = `evento-perito ${getTipoClase(asignacion.tipo_perito)}`;
                    evento.textContent = `${asignacion.perito_nombre?.split(' ')[0] || 'Sin nombre'}: ${asignacion.expediente || 'S/E'}`;
                    evento.title = `${asignacion.perito_nombre}\n${asignacion.observaciones || ''}`;
                    evento.onclick = () => verDetalleAsignacion(asignacion.id);
                    celda.appendChild(evento);
                });
                
                // Si hay más asignaciones, mostrar indicador
                if (asignacionesDia.length > maxMostrar) {
                    const masEventos = document.createElement('div');
                    masEventos.className = 'text-xs text-blue-600 font-bold cursor-pointer hover:underline mt-1';
                    masEventos.textContent = `+${asignacionesDia.length - maxMostrar} más`;
                    masEventos.onclick = () => verAsignacionesDia(fechaActual, dia);
                    celda.appendChild(masEventos);
                }
                
                // Click en celda vacía para ver todas las asignaciones
                if (asignacionesDia.length > 0) {
                    celda.style.cursor = 'pointer';
                    celda.onclick = (e) => {
                        if (e.target === celda || e.target === numeroDia) {
                            verAsignacionesDia(fechaActual, dia);
                        }
                    };
                }
                
                calendarioBody.appendChild(celda);
            }
            
            // Rellenar celdas vacías al final
            const totalCeldas = calendarioBody.children.length;
            const celdasFaltantes = totalCeldas % 7 === 0 ? 0 : 7 - (totalCeldas % 7);
            for (let i = 0; i < celdasFaltantes; i++) {
                const celda = document.createElement('div');
                celda.className = 'calendario-dia border-r border-b bg-gray-50';
                calendarioBody.appendChild(celda);
            }
        }

        /**
         * Obtener clase CSS según tipo de perito
         */
        function getTipoClase(tipo) {
            const clases = {
                'Informático': 'tipo-informatico',
                'Acústico': 'tipo-acustico',
                'Antropólogo': 'tipo-antropologo',
                'Contable': 'tipo-contable'
            };
            return clases[tipo] || 'tipo-informatico';
        }

        /**
         * Actualizar estadísticas del mes
         */
        function actualizarEstadisticas() {
            const stats = {
                total: asignacionesDelMes.length,
                pendientes: asignacionesDelMes.filter(a => a.estado === 'Pendiente').length,
                enProceso: asignacionesDelMes.filter(a => a.estado === 'En Proceso').length,
                completados: asignacionesDelMes.filter(a => a.estado === 'Completado').length
            };
            
            const html = `
                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-blue-500">
                    <p class="text-sm text-gray-600 font-semibold">Total del Mes</p>
                    <p class="text-2xl font-bold text-gray-800">${stats.total}</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-yellow-500">
                    <p class="text-sm text-gray-600 font-semibold">Pendientes</p>
                    <p class="text-2xl font-bold text-yellow-600">${stats.pendientes}</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-orange-500">
                    <p class="text-sm text-gray-600 font-semibold">En Proceso</p>
                    <p class="text-2xl font-bold text-orange-600">${stats.enProceso}</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-green-500">
                    <p class="text-sm text-gray-600 font-semibold">Completados</p>
                    <p class="text-2xl font-bold text-green-600">${stats.completados}</p>
                </div>
            `;
            
            document.getElementById('estadisticasMes').innerHTML = html;
        }

        /**
         * Navegación de calendario
         */
        function mesAnterior() {
            if (mesActual === 0) {
                mesActual = 11;
                anioActual--;
            } else {
                mesActual--;
            }
            document.getElementById('mesSelect').value = mesActual;
            document.getElementById('anioSelect').value = anioActual;
            cargarCalendario();
        }

        function mesSiguiente() {
            if (mesActual === 11) {
                mesActual = 0;
                anioActual++;
            } else {
                mesActual++;
            }
            document.getElementById('mesSelect').value = mesActual;
            document.getElementById('anioSelect').value = anioActual;
            cargarCalendario();
        }

        function irHoy() {
            const hoy = new Date();
            mesActual = hoy.getMonth();
            anioActual = hoy.getFullYear();
            document.getElementById('mesSelect').value = mesActual;
            document.getElementById('anioSelect').value = anioActual;
            cargarCalendario();
        }

        /**
         * Ver todas las asignaciones de un día específico
         */
        function verAsignacionesDia(fecha, dia) {
            const nombresMeses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                                  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            
            document.getElementById('tituloDia').innerHTML = `
                <i class="fas fa-calendar-day mr-2"></i>Asignaciones del ${dia} de ${nombresMeses[mesActual]} ${anioActual}
            `;
            
            // Filtrar asignaciones del día
            const asignacionesDia = asignacionesDelMes.filter(a => {
                return fecha >= a.fecha_inicio && fecha <= a.fecha_fin;
            });
            
            let html = '';
            
            if (asignacionesDia.length === 0) {
                html = `
                    <div class="text-center py-8">
                        <i class="fas fa-calendar-times text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500">No hay asignaciones para este día</p>
                    </div>
                `;
            } else {
                asignacionesDia.forEach(asignacion => {
                    html += `
                        <div class="bg-gray-50 rounded-lg p-4 mb-4 hover:bg-gray-100 transition cursor-pointer"
                             onclick="verDetalleAsignacion(${asignacion.id})">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-800 text-lg">
                                        ${asignacion.perito_nombre || 'Sin nombre'}
                                    </h4>
                                    <p class="text-sm text-gray-600">
                                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${getTipoClase(asignacion.tipo_perito)}">
                                            ${asignacion.tipo_perito}
                                        </span>
                                    </p>
                                </div>
                                <div>
                                    ${getEstadoBadge(asignacion.estado)}
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3 text-sm mt-3">
                                <div>
                                    <span class="font-semibold text-gray-600">Expediente:</span>
                                    <p class="text-gray-800">${asignacion.expediente || '-'}</p>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-600">Hoja Envío:</span>
                                    <p class="text-gray-800">${asignacion.hoja_envio || '-'}</p>
                                </div>
                                <div class="col-span-2">
                                    <span class="font-semibold text-gray-600">Período:</span>
                                    <p class="text-gray-800">
                                        <i class="far fa-calendar text-green-500 mr-1"></i>
                                        ${asignacion.fecha_inicio} al ${asignacion.fecha_fin}
                                    </p>
                                </div>
                                <div class="col-span-2">
                                    <span class="font-semibold text-gray-600">Lugar:</span>
                                    <p class="text-gray-800">
                                        <i class="fas fa-map-marker-alt text-red-500 mr-1"></i>
                                        ${asignacion.lugar || '-'}
                                    </p>
                                </div>
                            </div>
                            
                            <div class="mt-3 text-right">
                                <button class="text-blue-600 hover:text-blue-800 text-sm font-semibold">
                                    <i class="fas fa-eye mr-1"></i>Ver detalles completos
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            document.getElementById('contenidoDia').innerHTML = html;
            document.getElementById('modalDia').classList.remove('hidden');
        }

        /**
         * Ver detalle completo de una asignación
         */
        function verDetalleAsignacion(id) {
            cerrarModalDia();
            
            fetch(`/api/asignacion/${id}`)
                .then(response => response.json())
                .then(data => {
                    const contenido = `
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-2 bg-blue-50 p-4 rounded-lg mb-4">
                                <h4 class="text-lg font-bold text-blue-900 mb-2">
                                    <i class="fas fa-file-alt mr-2"></i>Información General
                                </h4>
                            </div>
                            
                            <div>
                                <label class="text-sm font-semibold text-gray-600">Hoja de Envío:</label>
                                <p class="text-gray-800">${data.hoja_envio || '-'}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-semibold text-gray-600">Expediente:</label>
                                <p class="text-gray-800">${data.expediente || '-'}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-semibold text-gray-600">Dependencia:</label>
                                <p class="text-gray-800">${data.dependencia || '-'}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-semibold text-gray-600">Tipo de Perito:</label>
                                <p class="text-gray-800">${data.tipo_perito || '-'}</p>
                            </div>
                            
                            <div class="col-span-2">
                                <label class="text-sm font-semibold text-gray-600">Carpeta Fiscal:</label>
                                <p class="text-gray-800">${data.carpeta_fiscal || '-'}</p>
                            </div>
                            
                            <div class="col-span-2 bg-green-50 p-4 rounded-lg my-4">
                                <h4 class="text-lg font-bold text-green-900 mb-2">
                                    <i class="fas fa-user-tie mr-2"></i>Perito Asignado
                                </h4>
                            </div>
                            
                            <div class="col-span-2">
                                <label class="text-sm font-semibold text-gray-600">Nombre del Perito:</label>
                                <p class="text-gray-800 text-lg font-semibold">${data.perito_nombre || data.perito_asignado}</p>
                            </div>
                            
                            <div class="col-span-2 bg-purple-50 p-4 rounded-lg my-4">
                                <h4 class="text-lg font-bold text-purple-900 mb-2">
                                    <i class="fas fa-calendar-alt mr-2"></i>Fechas y Ubicación
                                </h4>
                            </div>
                            
                            <div>
                                <label class="text-sm font-semibold text-gray-600">Fecha Inicio:</label>
                                <p class="text-gray-800">
                                    <i class="far fa-calendar-check text-green-600 mr-1"></i>
                                    ${data.fecha_inicio}
                                </p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-semibold text-gray-600">Fecha Fin:</label>
                                <p class="text-gray-800">
                                    <i class="far fa-calendar-times text-red-600 mr-1"></i>
                                    ${data.fecha_fin}
                                </p>
                            </div>
                            
                            <div class="col-span-2">
                                <label class="text-sm font-semibold text-gray-600">Lugar:</label>
                                <p class="text-gray-800">
                                    <i class="fas fa-map-marker-alt text-red-500 mr-1"></i>
                                    ${data.lugar || '-'}
                                </p>
                            </div>
                            
                            <div class="col-span-2 bg-yellow-50 p-4 rounded-lg my-4">
                                <h4 class="text-lg font-bold text-yellow-900 mb-2">
                                    <i class="fas fa-file-signature mr-2"></i>Documentos Oficiales
                                </h4>
                            </div>
                            
                            <div>
                                <label class="text-sm font-semibold text-gray-600">Designación:</label>
                                <p class="text-gray-800">${data.desginacion || '-'}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-semibold text-gray-600">Oficio Desplazamiento:</label>
                                <p class="text-gray-800">${data.oficio_desplazamiento || '-'}</p>
                            </div>
                            
                            <div class="col-span-2">
                                <label class="text-sm font-semibold text-gray-600">Observaciones:</label>
                                <p class="text-gray-800 bg-gray-50 p-3 rounded-lg">${data.observaciones || 'Sin observaciones'}</p>
                            </div>
                            
                            <div class="col-span-2">
                                <label class="text-sm font-semibold text-gray-600">Estado Actual:</label>
                                <p class="text-gray-800">
                                    ${getEstadoBadge(data.estado)}
                                </p>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex justify-end space-x-3">
                            <button onclick="cerrarModalDetalle()" 
                                    class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                                <i class="fas fa-times mr-2"></i>Cerrar
                            </button>
                        </div>
                    `;
                    
                    document.getElementById('contenidoDetalle').innerHTML = contenido;
                    document.getElementById('modalDetalle').classList.remove('hidden');
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cargar el detalle de la asignación');
                });
        }

        /**
         * Obtener badge de estado
         */
        function getEstadoBadge(estado) {
            const badges = {
                'Completado': '<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"><i class="fas fa-check-circle mr-1"></i>Completado</span>',
                'En Proceso': '<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800"><i class="fas fa-spinner mr-1"></i>En Proceso</span>',
                'Pendiente': '<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"><i class="fas fa-clock mr-1"></i>Pendiente</span>',
                'Cancelado': '<span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800"><i class="fas fa-times-circle mr-1"></i>Cancelado</span>'
            };
            return badges[estado] || estado;
        }

        /**
         * Cerrar modales
         */
        function cerrarModalDia() {
            document.getElementById('modalDia').classList.add('hidden');
        }

        function cerrarModalDetalle() {
            document.getElementById('modalDetalle').classList.add('hidden');
        }

        // Cerrar modales al hacer clic fuera
        document.getElementById('modalDia').addEventListener('click', function(e) {
            if (e.target === this) cerrarModalDia();
        });

        document.getElementById('modalDetalle').addEventListener('click', function(e) {
            if (e.target === this) cerrarModalDetalle();
        });
    </script>
</body>
</html>
